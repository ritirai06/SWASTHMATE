<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swasthmate</title>
        <!-- Import Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
        <!-- Import Material Icons -->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/legacy.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">
    <!-- html2pdf library for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        /* Progress Tracker Styles */
        .progress-tracker-container-modern {
            padding: 2rem;
            background: white;
            border-radius: 12px;
            margin-top: 1rem;
        }
        
        .progress-steps-wrapper-modern {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            margin-bottom: 1rem;
        }
        
        .progress-step-modern {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            position: relative;
            z-index: 2;
        }
        
        .step-circle-modern {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #e5e7eb;
            border: 3px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
        }
        
        .progress-step-modern.active .step-circle-modern {
            background: #667eea;
            border-color: #667eea;
            color: white;
            transform: scale(1.1);
        }
        
        .progress-step-modern.completed .step-circle-modern {
            background: #10b981;
            border-color: #10b981;
            color: white;
        }
        
        .step-number-modern {
            font-weight: 700;
            font-size: 1.2rem;
            color: #6b7280;
        }
        
        .progress-step-modern.active .step-number-modern,
        .progress-step-modern.completed .step-number-modern {
            color: white;
        }
        
        .step-label-modern {
            font-size: 0.875rem;
            color: #6b7280;
            font-weight: 500;
            text-align: center;
        }
        
        .progress-step-modern.active .step-label-modern {
            color: #667eea;
            font-weight: 700;
        }
        
        .progress-step-modern.completed .step-label-modern {
            color: #10b981;
        }
        
        .progress-connector-modern {
            flex: 1;
            height: 3px;
            background: #e5e7eb;
            margin: 0 0.5rem;
            position: relative;
            top: -25px;
            z-index: 1;
        }
        
        .progress-line-modern {
            width: 100%;
            height: 4px;
            background: #e5e7eb;
            border-radius: 2px;
            margin: 1rem 0;
            overflow: hidden;
        }
        
        .progress-line-fill-modern {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 2px;
            transition: width 0.3s ease;
            width: 0%;
        }
        
        .progress-status-text-modern {
            text-align: center;
            color: #475569;
            font-weight: 600;
            font-size: 1rem;
            margin-top: 1rem;
        }
        
        /* Result Display Styles */
        .result-display-section-modern {
            margin-top: 2rem;
            padding: 2rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .result-header-modern {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .result-header-modern h3 {
            color: #1e293b;
            margin-bottom: 0.5rem;
        }
        
        .result-filename {
            color: #64748b;
            font-size: 0.9rem;
        }
        
        .result-content-modern {
            margin: 2rem 0;
        }
        
        .result-summary-modern {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .result-card-modern {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            padding: 1.5rem;
            border-radius: 12px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .result-card-modern:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
        }
        
        .result-card-modern h4 {
            color: #1e293b;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }
        
        .result-card-modern ul {
            list-style: none;
            padding-left: 0;
        }
        
        .result-card-modern ul li {
            padding: 0.5rem 0;
            color: #475569;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .result-card-modern ul li:last-child {
            border-bottom: none;
        }
        
        /* Modern Card Styles */
        .info-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            margin-bottom: 1.5rem;
        }
        
        .info-card h3 {
            margin: 0 0 0.5rem 0;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .info-card p {
            margin: 0.25rem 0;
            opacity: 0.95;
        }
        
        .disease-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 1.25rem;
            margin: 0.75rem 0;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .disease-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
            transform: translateX(4px);
        }
        
        .disease-card::before {
            content: 'ü¶†';
            font-size: 1.5rem;
        }
        
        .recommendation-card {
            background: linear-gradient(135deg, #fff5f5 0%, #fff1f2 100%);
            border-left: 4px solid #f87171;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }
        
        .recommendation-card:hover {
            box-shadow: 0 4px 16px rgba(248, 113, 113, 0.2);
            transform: translateY(-2px);
        }
        
        .recommendation-card.priority {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-left-color: #f59e0b;
        }
        
        .recommendation-card h4 {
            color: #1e293b;
            margin: 0 0 0.75rem 0;
            font-size: 1.1rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .recommendation-card h4::before {
            content: 'üéØ';
            font-size: 1.25rem;
        }
        
        .recommendation-card.priority h4::before {
            content: '‚ù§Ô∏è';
        }
        
        .recommendation-card p {
            color: #475569;
            margin: 0.5rem 0;
            line-height: 1.6;
        }
        
        .recommendation-card .action-text {
            color: #667eea;
            font-weight: 600;
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid #e5e7eb;
            font-style: italic;
        }
        
        .general-rec-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            padding: 1rem 1.25rem;
            margin: 0.5rem 0;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }
        
        .general-rec-card:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);
            transform: translateX(4px);
        }
        
        .general-rec-card::before {
            content: 'üí°';
            font-size: 1.25rem;
            flex-shrink: 0;
        }
        
        .drug-interaction-card {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border-left: 4px solid #dc2626;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
            box-shadow: 0 2px 8px rgba(220, 38, 38, 0.15);
        }
        
        .drug-interaction-card h4 {
            color: #991b1b;
            margin: 0 0 0.75rem 0;
            font-size: 1.1rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .drug-interaction-card h4::before {
            content: '‚ö†Ô∏è';
            font-size: 1.25rem;
        }
        
        .drug-interaction-card .drug-names {
            color: #991b1b;
            font-weight: 700;
            font-size: 1.05rem;
            margin: 0.5rem 0;
        }
        
        .drug-interaction-card p {
            color: #7f1d1d;
            margin: 0.5rem 0;
            line-height: 1.6;
        }
        
        .test-result-card {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            margin: 0.5rem 0;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
            border-left: 4px solid #e5e7eb;
            transition: all 0.2s ease;
        }
        
        .test-result-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }
        
        .test-result-card.high {
            border-left-color: #dc2626;
            background: linear-gradient(135deg, #fef2f2 0%, #ffffff 100%);
        }
        
        .test-result-card.low {
            border-left-color: #d97706;
            background: linear-gradient(135deg, #fffbeb 0%, #ffffff 100%);
        }
        
        .test-result-card.normal {
            border-left-color: #059669;
            background: linear-gradient(135deg, #ecfdf5 0%, #ffffff 100%);
        }
        
        .test-result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        
        .test-result-name {
            font-weight: 700;
            color: #1e293b;
            font-size: 1.05rem;
        }
        
        .test-result-value {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-wrap: wrap;
        }
        
        .test-result-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.75rem;
            margin-top: 0.5rem;
            padding-top: 0.75rem;
            border-top: 1px solid #e5e7eb;
        }
        
        .test-detail-item {
            display: flex;
            flex-direction: column;
        }
        
        .test-detail-label {
            font-size: 0.75rem;
            color: #64748b;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .test-detail-value {
            font-size: 0.95rem;
            color: #1e293b;
            font-weight: 600;
            margin-top: 0.25rem;
        }
        
        .section-header-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.25rem 1.5rem;
            border-radius: 12px 12px 0 0;
            margin: 2rem 0 0 0;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .section-header-card h2 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .section-content-wrapper {
            background: white;
            border-radius: 0 0 12px 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            margin-bottom: 2rem;
        }
        
        .measurements-table-modern {
            overflow-x: auto;
        }
        
        .measurements-table-modern table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        .measurements-table-modern th {
            background: #667eea;
            color: white;
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
        }
        
        .measurements-table-modern td {
            padding: 0.75rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .status-badge.status-high {
            background: #fee2e2;
            color: #dc2626;
        }
        
        .status-badge.status-low {
            background: #fef3c7;
            color: #d97706;
        }
        
        .status-badge.status-normal {
            background: #d1fae5;
            color: #059669;
        }
        
        .result-actions-modern {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
            flex-wrap: wrap;
        }
        
        .btn-secondary-modern {
            background: #6b7280;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-secondary-modern:hover {
            background: #4b5563;
            transform: translateY(-2px);
        }
        
        .btn-success-modern {
            background: #10b981;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-success-modern:hover {
            background: #059669;
            transform: translateY(-2px);
        }
        
        /* Professional Report Layout */
        .professional-report {
            background: white;
            padding: 2.5rem;
            max-width: 900px;
            margin: 0 auto;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            color: #1e293b;
        }
        
        .report-header {
            border-bottom: 4px solid #667eea;
            padding-bottom: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .report-header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
        }
        
        .report-logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .report-logo-box {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .report-logo-img {
            width: 50px;
            height: 50px;
            object-fit: contain;
        }
        
        .report-logo-text {
            font-size: 1.75rem;
            font-weight: 700;
            color: #667eea;
        }
        
        .report-company-info {
            margin-left: 0.5rem;
        }
        
        .report-company-name {
            font-size: 1rem;
            font-weight: 600;
            color: #1e293b;
        }
        
        .report-company-tagline {
            font-size: 0.875rem;
            color: #64748b;
        }
        
        .report-date-section {
            text-align: right;
        }
        
        .report-date-label {
            font-size: 0.875rem;
            color: #64748b;
            margin-bottom: 0.25rem;
        }
        
        .report-date-value {
            font-size: 1rem;
            font-weight: 600;
            color: #1e293b;
        }
        
        .report-title-section {
            text-align: center;
            margin-top: 1.5rem;
        }
        
        .report-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: #1e293b;
            margin: 0;
            letter-spacing: 1px;
        }
        
        .report-title-line {
            width: 100px;
            height: 3px;
            background: #667eea;
            margin: 0.75rem auto;
        }
        
        .patient-info-section {
            background: #f8fafc;
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }
        
        .patient-info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .patient-info-item {
            padding: 0.75rem;
            background: white;
            border-radius: 6px;
            border-left: 3px solid #667eea;
        }
        
        .patient-info-label {
            font-size: 0.875rem;
            color: #64748b;
            font-weight: 500;
            margin-bottom: 0.25rem;
        }
        
        .patient-info-value {
            font-size: 1rem;
            color: #1e293b;
            font-weight: 600;
        }
        
        .report-section {
            margin: 2rem 0;
            page-break-inside: avoid;
        }
        
        .report-section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .report-info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .report-info-item {
            padding: 0.75rem;
            background: #f8fafc;
            border-radius: 6px;
        }
        
        .report-info-label {
            font-size: 0.875rem;
            color: #64748b;
            font-weight: 500;
        }
        
        .report-info-value {
            font-size: 1rem;
            color: #1e293b;
            font-weight: 600;
            margin-top: 0.25rem;
        }
        
        .report-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            background: white;
        }
        
        .report-table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .report-table th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
        }
        
        .report-table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .report-table tbody tr:hover {
            background: #f8fafc;
        }
        
        .report-badge {
            display: inline-block;
            padding: 0.375rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .report-badge-high {
            background: #fee2e2;
            color: #dc2626;
        }
        
        .report-badge-low {
            background: #fef3c7;
            color: #d97706;
        }
        
        .report-badge-normal {
            background: #d1fae5;
            color: #059669;
        }
        
        .report-list {
            list-style: none;
            padding: 0;
        }
        
        .report-list li {
            padding: 0.75rem;
            margin: 0.5rem 0;
            background: #f8fafc;
            border-left: 4px solid #667eea;
            border-radius: 4px;
        }
        
        .report-footer {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 3px solid #e5e7eb;
        }
        
        .report-footer-line {
            width: 100%;
            height: 2px;
            background: #667eea;
            margin-bottom: 1.5rem;
        }
        
        .report-footer-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
            margin-bottom: 1.5rem;
        }
        
        .report-footer-left {
            border-right: 2px solid #e5e7eb;
            padding-right: 2rem;
        }
        
        .report-footer-logo-text {
            font-size: 1.25rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 0.5rem;
        }
        
        .report-footer-address {
            font-size: 0.875rem;
            color: #64748b;
            line-height: 1.6;
        }
        
        .report-footer-right {
            padding-left: 1rem;
        }
        
        .report-footer-disclaimer {
            font-size: 0.75rem;
            color: #64748b;
            line-height: 1.6;
        }
        
        .report-footer-disclaimer strong {
            color: #dc2626;
        }
        
        .report-footer-bottom {
            text-align: center;
            padding-top: 1rem;
            border-top: 1px solid #e5e7eb;
            color: #64748b;
            font-size: 0.75rem;
        }
        
        @media print {
            .professional-report {
                padding: 0;
                max-width: 100%;
            }
            
            .result-actions-modern {
                display: none;
            }
        }
        
        @media (max-width: 768px) {
            .progress-steps-wrapper-modern {
                flex-direction: column;
                gap: 1rem;
            }
            
            .progress-connector-modern {
                display: none;
            }
            
            .result-actions-modern {
                flex-direction: column;
            }
            
            .result-actions-modern button {
                width: 100%;
            }
            
            .section-header-card h2 {
                font-size: 1.25rem;
            }
            
            .section-content-wrapper {
                padding: 1rem;
            }
            
            .disease-card,
            .recommendation-card,
            .general-rec-card,
            .drug-interaction-card,
            .test-result-card {
                padding: 1rem;
            }
            
            .test-result-details {
                grid-template-columns: 1fr;
            }
            
            .test-result-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            
            .info-card {
                padding: 1.25rem;
            }
        }
    </style>
    </head>
    <body>
    <!-- Header -->
    <header class="header-modern">
        <div class="container-modern">
            <div class="navbar-modern">
                <!-- Logo -->
                <div class="logo-modern">
                    <div class="logo-icon-modern">
                        <img src="{{ url_for('static', filename='logo.png') }}" alt="Swasthmate Logo">
                    </div>
                    <span class="logo-text-modern">Swasth<span class="mate-part">mate</span></span>
                      </div>

                <!-- Desktop Navigation -->
                <nav class="nav-modern" aria-label="Main navigation">
                    <a href="/" class="nav-link-modern">Home</a>
                    <a href="/upload" class="nav-link-modern">Prescription Reader</a>
                    <a href="/MedAssist" class="nav-link-modern">MedAssist</a>
                    <a href="/about" class="nav-link-modern">About Us</a>
                    <a href="/contact" class="nav-link-modern">Contact</a>
                </nav>

                <!-- Right Side Actions -->
                <div class="header-actions-modern">
                    <div id="loginButtonContainer">
                        <a href="/login" class="login-btn-modern">Log In / Sign up</a>
                    </div>
                    <div id="profileButtonContainer" class="profile-container-modern" style="display: none;">
                        <button class="user-icon-btn" onclick="toggleProfileDropdown()">
                            <i class="fas fa-user"></i>
                        </button>
                        <div class="profile-dropdown-modern" id="profileDropdownModern">
                            <div class="profile-header-modern">
                                <div class="profile-info-modern">
                                    <div class="profile-avatar-modern" id="profileAvatarModern">U</div>
                                    <div class="profile-details-modern">
                                        <h3 id="dropdown-user-name-modern">User</h3>
                                        <p id="dropdown-user-email-modern">user@example.com</p>
                                    </div>
                                </div>
                            </div>
                            <div class="profile-menu-modern">
                                <button type="button" class="profile-menu-item-modern" onclick="editProfile();" aria-label="Edit profile">
                                <i class="fas fa-edit"></i>
                                Edit Profile
                            </a>
                                <button class="profile-menu-item-modern logout-modern" onclick="handleLogout()">
                                <i class="fas fa-sign-out-alt"></i>
                                Logout
                            </button>
                        </div>
                    </div>
                </div>
                    <button class="menu-toggle" onclick="toggleMobileMenu()">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
                    </div>
                
            <!-- Mobile Menu -->
            <div class="mobile-menu" id="mobileMenu" aria-label="Mobile navigation menu">
                <nav class="mobile-nav" aria-label="Mobile navigation">
                    <a href="/" class="mobile-nav-link">Home</a>
                    <a href="/upload" class="mobile-nav-link">Prescription Reader</a>
                    <a href="/MedAssist" class="mobile-nav-link">MedAssist</a>
                    <a href="/about" class="mobile-nav-link">About Us</a>
                    <a href="/contact" class="mobile-nav-link">Contact</a>
            </nav>
            </div>
        </div>
    </header>
    

    <!-- Profile Modal -->
    <section id="profile-view" style="display: none;">
        <div class="profile-modal">
            <button class="close-profile" onclick="closeProfile()">&times;</button>
            <h2>My Profile</h2>
           <form id="edit-profile-form">
      <p><strong>Name:</strong> <input type="text" id="edit-name" required></p>
      <p><strong>Email:</strong> <input type="email" id="edit-email" required></p>
      <p><strong>Password:</strong> <input type="password" id="edit-password" required></p>
      <button type="submit" class="demo-button">Save Changes</button>
    </form>
        </div>
    </section>

    <main>
        <!-- Hero Section -->
        <section class="hero-modern" id="home">
            <!-- Animated Background Elements -->
            <div class="hero-bg-animation">
                <div class="bg-blob bg-blob-1"></div>
                <div class="bg-blob bg-blob-2"></div>
            </div>
            
            <div class="container-modern">
                <!-- Medical Icons Row -->
                <div class="medical-icons-row">
                    <div class="med-icon-item">
                        <i class="fas fa-stethoscope"></i>
                    </div>
                    <div class="med-icon-item">
                        <i class="fas fa-pills"></i>
                    </div>
                    <div class="med-icon-item">
                        <i class="fas fa-heartbeat"></i>
                    </div>
                    <div class="med-icon-item">
                        <i class="fas fa-tint"></i>
                    </div>
                    <div class="med-icon-item">
                        <i class="fas fa-heart"></i>
                    </div>
                </div>

                <!-- Hero Content -->
                <div class="hero-content-modern">
                    <!-- Trust Badge -->
                    <div class="trust-badge-modern">
                        <div class="trust-dot-modern"></div>
                        <span>Trusted by many users </span>
                    </div>

                    <!-- Title -->
                    <h1 class="hero-title-modern">Analyze Medical Reports Instantly</h1>
                    
                    <!-- Description -->
                    <p class="hero-description-modern">
                        Upload your lab reports and get AI-Powered insights about your health values, trends, and recommendations.
                    </p>

                    <!-- CTA Buttons -->
                    <div class="hero-cta-modern">
                        <button class="btn-primary-modern" onclick="document.getElementById('file-upload')?.click()">
                            Start Free Trial
                        </button>
                        <button class="btn-outline-modern">
                            See How It Works
                        </button>
                    </div>

                    <!-- Trial Info -->
                    <p class="trial-info-modern">
                        No credit card required ‚Ä¢ 14-day free trial ‚Ä¢ Cancel anytime
                    </p>
                </div>
            </div>
        </section>

        <!-- Trust Badges Section -->
        <section class="trust-badges-section">
            <div class="container-modern">
                <div class="trust-badges-grid">
                    <div class="trust-badge-item">
                        <div class="trust-icon-box">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <span>HIPAA Compliant</span>
                    </div>
                    <div class="trust-badge-item">
                        <div class="trust-icon-box">
                            <i class="fas fa-certificate"></i>
                        </div>
                        <span>Clinical Precision</span>
                    </div>
                    <div class="trust-badge-item">
                        <div class="trust-icon-box">
                            <i class="fas fa-lock"></i>
                        </div>
                        <span>256-bit Encryption</span>
                    </div>
                    <div class="trust-badge-item">
                        <div class="trust-icon-box">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <span>99.9% Uptime SLA</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Upload Section -->
        <section class="upload-section-modern" id="prescription">
            <div class="container-modern">
                <div class="upload-card-modern">
                    <div class="upload-header">
                <h2>Upload Your Medical Report</h2>
                <p>We support PDF, JPG, and PNG formats. All uploads are encrypted and securely stored.</p>
                    </div>

                    <!-- Upload Area -->
                    <div class="upload-area-modern" id="dropzone-modern">
                        <input type="file" id="file-upload" class="file-input-hidden" accept=".pdf,.jpg,.jpeg,.png">
                        
                        <div class="upload-content" id="uploadContent">
                            <div class="upload-icon-large">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <h3>Drag & Drop your file here</h3>
                            <p class="upload-or">or</p>
                            <button class="btn-primary-modern" onclick="document.getElementById('file-upload').click()">
                                Browse Files
                            </button>
                        </div>

                        <!-- Progress Tracker (Hidden by default) -->
                        <div class="progress-tracker-container-modern" id="progressTrackerContainer" style="display: none;">
                            <h3 style="text-align: center; margin-bottom: 2rem; color: #1e293b;">üìä Processing Your Report</h3>
                            
                            <!-- Progress Steps -->
                            <div class="progress-steps-wrapper-modern">
                                <div class="progress-step-modern" id="step1-modern">
                                    <div class="step-circle-modern">
                                        <span class="step-number-modern">1</span>
                                    </div>
                                    <div class="step-label-modern">Uploading</div>
                                </div>
                                <div class="progress-connector-modern"></div>
                                <div class="progress-step-modern" id="step2-modern">
                                    <div class="step-circle-modern">
                                        <span class="step-number-modern">2</span>
                                    </div>
                                    <div class="step-label-modern">Analysis</div>
                                </div>
                                <div class="progress-connector-modern"></div>
                                <div class="progress-step-modern" id="step3-modern">
                                    <div class="step-circle-modern">
                                        <span class="step-number-modern">3</span>
                                    </div>
                                    <div class="step-label-modern">Processing</div>
                                </div>
                                <div class="progress-connector-modern"></div>
                                <div class="progress-step-modern" id="step4-modern">
                                    <div class="step-circle-modern">
                                        <span class="step-number-modern">4</span>
                                    </div>
                                    <div class="step-label-modern">Result</div>
                                </div>
                            </div>
                            
                            <!-- Progress Line -->
                            <div class="progress-line-modern">
                                <div class="progress-line-fill-modern" id="progressLineFillModern"></div>
                            </div>
                            
                            <!-- Status Text -->
                            <div class="progress-status-text-modern" id="progressStatusTextModern">Preparing to upload...</div>
                        </div>
                    </div>
                    
                    <!-- Result Display Section (Hidden by default) -->
                    <div class="result-display-section-modern" id="resultDisplaySection" style="display: none;">
                        <div class="result-header-modern">
                            <h3>‚úÖ Report Analysis Complete</h3>
                            <p id="resultFileName" class="result-filename"></p>
                        </div>
                        
                        <div class="result-content-modern" id="resultContent">
                            <!-- Formatted results will be displayed here -->
                        </div>
                        
                        <div class="result-actions-modern">
                            <button class="btn-primary-modern" id="viewReportBtn">
                                <i class="fas fa-eye"></i> View Report
                            </button>
                            <button class="btn-success-modern" id="downloadReportBtn">
                                <i class="fas fa-download"></i> Download PDF
                            </button>
                            <button class="btn-secondary-modern" id="uploadNewBtn">
                                <i class="fas fa-upload"></i> Upload New
                            </button>
                        </div>
                    </div>

                    <!-- Security Features -->
                    <div class="security-features-grid">
                        <div class="security-feature">
                            <div class="security-icon-box">
                                <i class="fas fa-lock"></i>
                            </div>
                            <div>
                                <h4>Encrypted</h4>
                                <p>256-bit encryption</p>
                            </div>
                        </div>
                        <div class="security-feature">
                            <div class="security-icon-box security-icon-green">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div>
                                <h4>HIPAA Compliant</h4>
                                <p>Secure storage</p>
                            </div>
                        </div>
                        <div class="security-feature">
                            <div class="security-icon-box security-icon-purple">
                                <i class="fas fa-file-medical"></i>
                            </div>
                            <div>
                                <h4>Fast Analysis</h4>
                                <p>Results in seconds</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section class="features-section-modern">
            <div class="container-modern">
                <div class="section-header-modern">
                    <h2>Why Choose Swasthmate</h2>
                    <p>Experience the future of medical report analysis with our comprehensive features</p>
                </div>

                <div class="features-grid-modern">
                    <div class="feature-card-modern feature-blue">
                        <div class="feature-icon-box feature-icon-blue">
                            <i class="fas fa-brain"></i>
                        </div>
                        <h3>AI-Powered Analysis</h3>
                        <p>Advanced algorithms analyze your reports with medical precision and accuracy.</p>
                    </div>
                    <div class="feature-card-modern feature-green">
                        <div class="feature-icon-box feature-icon-green">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3>Trend Tracking</h3>
                        <p>Monitor your health metrics over time and identify patterns in your data.</p>
                    </div>
                    <div class="feature-card-modern feature-yellow">
                        <div class="feature-icon-box feature-icon-yellow">
                            <i class="fas fa-bell"></i>
                        </div>
                        <h3>Smart Alerts</h3>
                        <p>Get notified about important changes in your health values automatically.</p>
                    </div>
                    <div class="feature-card-modern feature-purple">
                        <div class="feature-icon-box feature-icon-purple">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h3>Data Security</h3>
                        <p>Your medical data is encrypted and stored with enterprise-grade security.</p>
                    </div>
                    <div class="feature-card-modern feature-orange">
                        <div class="feature-icon-box feature-icon-orange">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <h3>Instant Results</h3>
                        <p>Receive comprehensive analysis and insights within seconds of uploading.</p>
                    </div>
                    <div class="feature-card-modern feature-pink">
                        <div class="feature-icon-box feature-icon-pink">
                            <i class="fas fa-users"></i>
                        </div>
                        <h3>Expert Recommendations</h3>
                        <p>Get personalized health recommendations based on your report analysis.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- How It Works Section -->
        <section class="how-it-works-modern">
            <div class="container-modern">
                <div class="section-header-modern">
                    <h2>How It Works</h2>
                    <p>Get started with Swasthmate in four simple steps</p>
                </div>

                <div class="steps-grid-modern">
                    <div class="step-card-modern">
                        <div class="step-icon-wrapper">
                            <div class="step-icon-box">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <div class="step-number">01</div>
                        </div>
                        <h3>Upload Report</h3>
                        <p>Securely upload your medical report in PDF, JPG, or PNG format.</p>
                    </div>
                    <div class="step-connector-line"></div>
                    <div class="step-card-modern">
                        <div class="step-icon-wrapper">
                            <div class="step-icon-box">
                                <i class="fas fa-search"></i>
                            </div>
                            <div class="step-number">02</div>
                        </div>
                        <h3>AI Analysis</h3>
                        <p>Our AI scans and analyzes all health metrics in your report.</p>
                    </div>
                    <div class="step-connector-line"></div>
                    <div class="step-card-modern">
                        <div class="step-icon-wrapper">
                            <div class="step-icon-box">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="step-number">03</div>
                        </div>
                        <h3>Get Insights</h3>
                        <p>Receive detailed insights, trends, and flagged values instantly.</p>
                    </div>
                    <div class="step-connector-line"></div>
                    <div class="step-card-modern">
                        <div class="step-icon-wrapper">
                            <div class="step-icon-box">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="step-number">04</div>
                        </div>
                        <h3>Track Progress</h3>
                        <p>Monitor your health journey with historical data and trends.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Stats Section -->
        <section class="stats-section-modern">
            <div class="container-modern">
                <div class="stats-grid-modern">
                    <div class="stat-item-modern">
                        <div class="stat-icon-box stat-icon-blue">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-value">50+</div>
                        <div class="stat-label">Active Users</div>
                    </div>
                    <div class="stat-item-modern">
                        <div class="stat-icon-box stat-icon-green">
                            <i class="fas fa-file-medical"></i>
                        </div>
                        <div class="stat-value">100+</div>
                        <div class="stat-label">Reports Analyzed</div>
                    </div>
                    <div class="stat-item-modern">
                        <div class="stat-icon-box stat-icon-yellow">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="stat-value">4.9</div>
                        <div class="stat-label">User Rating</div>
                    </div>
                    <div class="stat-item-modern">
                        <div class="stat-icon-box stat-icon-purple">
                            <i class="fas fa-award"></i>
                        </div>
                        <div class="stat-value">95%</div>
                        <div class="stat-label">Accuracy Rate</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- FAQ Section -->
        <section class="faq-section-modern">
            <div class="container-modern">
                <div class="section-header-modern">
                    <h2>Frequently Asked Questions</h2>
                    <p>Everything you need to know about Swasthmate</p>
                </div>
                
                <div class="faq-accordion-modern">
                    <div class="faq-item-modern">
                        <button type="button" class="faq-question-modern" onclick="toggleFAQ(this)" onkeydown="if(event.key==='Enter'||event.key===' '){toggleFAQ(this);event.preventDefault();}" aria-expanded="false">
                            <span>How accurate is the AI analysis?</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="faq-answer-modern">
                            <p>Our AI has been trained on millions of medical reports and achieves a 99.9% accuracy rate. All results are based on established medical reference ranges and guidelines. However, always consult with your healthcare provider for medical decisions.</p>
                        </div>
                    </div>
                    <div class="faq-item-modern">
                        <button type="button" class="faq-question-modern" onclick="toggleFAQ(this)" onkeydown="if(event.key==='Enter'||event.key===' '){toggleFAQ(this);event.preventDefault();}" aria-expanded="false">
                            <span>Is my medical data secure?</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="faq-answer-modern">
                            <p>Absolutely. We use bank-level 256-bit encryption for all data transmission and storage. We're HIPAA compliant and never share your data with third parties. Your reports are stored securely and only accessible by you.</p>
                        </div>
                    </div>
                    <div class="faq-item-modern">
                        <button type="button" class="faq-question-modern" onclick="toggleFAQ(this)" onkeydown="if(event.key==='Enter'||event.key===' '){toggleFAQ(this);event.preventDefault();}" aria-expanded="false">
                            <span>What types of medical reports can I upload?</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="faq-answer-modern">
                            <p>We support blood tests, lipid panels, metabolic panels, thyroid tests, vitamin levels, and most common laboratory reports. We accept PDF, JPG, and PNG formats. More report types are constantly being added.</p>
                        </div>
                    </div>
                    <div class="faq-item-modern">
                        <button type="button" class="faq-question-modern" onclick="toggleFAQ(this)" onkeydown="if(event.key==='Enter'||event.key===' '){toggleFAQ(this);event.preventDefault();}" aria-expanded="false">
                            <span>How long does the analysis take?</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="faq-answer-modern">
                            <p>Most reports are analyzed within 5-10 seconds. Complex multi-page reports may take up to 30 seconds. You'll receive instant notifications when your analysis is complete.</p>
                        </div>
                    </div>
                    <div class="faq-item-modern">
                        <button type="button" class="faq-question-modern" onclick="toggleFAQ(this)" onkeydown="if(event.key==='Enter'||event.key===' '){toggleFAQ(this);event.preventDefault();}" aria-expanded="false">
                            <span>Can I share my reports with my doctor?</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="faq-answer-modern">
                            <p>Yes! You can easily export your analyzed reports as PDF and share them with your healthcare provider. Professional plan users can also generate shareable links with customizable access permissions.</p>
                        </div>
                    </div>
                    <div class="faq-item-modern">
                        <button type="button" class="faq-question-modern" onclick="toggleFAQ(this)" onkeydown="if(event.key==='Enter'||event.key===' '){toggleFAQ(this);event.preventDefault();}" aria-expanded="false">
                            <span>Do you offer refunds?</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="faq-answer-modern">
                            <p>We offer a 30-day money-back guarantee for all paid plans. If you're not satisfied with Swasthmate, contact our support team for a full refund within the first 30 days.</p>
                        </div>
                    </div>
                    <div class="faq-item-modern">
                        <button type="button" class="faq-question-modern" onclick="toggleFAQ(this)" onkeydown="if(event.key==='Enter'||event.key===' '){toggleFAQ(this);event.preventDefault();}" aria-expanded="false">
                            <span>Can I cancel my subscription anytime?</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="faq-answer-modern">
                            <p>Yes, you can cancel your subscription at any time from your account settings. You'll continue to have access until the end of your billing period, and no future charges will be made.</p>
                        </div>
                    </div>
                    <div class="faq-item-modern">
                        <button type="button" class="faq-question-modern" onclick="toggleFAQ(this)" onkeydown="if(event.key==='Enter'||event.key===' '){toggleFAQ(this);event.preventDefault();}" aria-expanded="false">
                            <span>Is there a mobile app available?</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="faq-answer-modern">
                            <p>Currently, Swasthmate is available as a responsive web application that works perfectly on all devices. Native iOS and Android apps are in development and will be released soon.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Support Box -->
                <div class="support-box-modern">
                    <h3>Still have questions?</h3>
                    <p>Our support team is here to help you 24/7</p>
                    <a href="/contact" class="support-link-modern">Contact Support ‚Üí</a>
                </div>
            </div>
        </section>

        <!-- Analysis View (Hidden by default) -->
            <div id="analysis-view" class="center-box" style="display: none;">
            <h2>üìä Analysis Summary</h2>
            <div id="analysis-content" class="card result-card"></div>
            <div class="btn-area">
                <button id="view-report-btn" class="btn btn-secondary">View Full Report</button>
            </div>
            </div>

            <div id="diagnosis-view" class="center-box" style="display: none;">
                <h2>üßæ Full Diagnosis Report</h2>
            <div id="diagnosis-content" class="card report-card"></div>
            <div class="btn-area">
                <button id="print-btn" class="btn btn-success">üñ®Ô∏è Print</button>
                <button id="back-btn" class="btn btn-outline-primary">‚¨Ö Back</button>
            </div>
            </div>
    </main>

    <!-- Footer -->
    <footer class="footer-modern">
        <div class="container-modern">
            <div class="footer-grid-modern">
                <!-- Brand -->
                <div class="footer-brand">
                    <div class="footer-logo-modern">
                        <div class="logo-icon-modern">
                            <img src="{{ url_for('static', filename='logo.png') }}" alt="Swasthmate Logo">
                        </div>
                        <span class="logo-text-modern">Swasth<span class="mate-part">mate</span></span>
                    </div>
                    <p class="footer-description-modern">
                        AI-powered medical report analysis for better health insights.
                    </p>
                    <div class="social-links-modern">
                        <a href="#" class="social-link-modern"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="social-link-modern"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="social-link-modern"><i class="fab fa-linkedin-in"></i></a>
                        <a href="#" class="social-link-modern"><i class="fab fa-instagram"></i></a>
          </div>
      </div>
      
                <!-- Quick Links -->
                <div class="footer-column">
                    <h4>Quick Links</h4>
                    <ul class="footer-links-modern">
                        <li><a href="/">Home</a></li>
                        <li><a href="/upload">Prescription Reader</a></li>
                        <li><a href="/MedAssist">MedAssist</a></li>
                        <li><a href="/about">About Us</a></li>
                    </ul>
      </div>
      
                <!-- Services -->
                <div class="footer-column">
                    <h4>Services</h4>
                    <ul class="footer-links-modern">
                        <li><a href="/upload">Prescription Reader</a></li>
                        <li><a href="/MedAssist">MedAssist</a></li>
                        <li><a href="/">Report Analysis</a></li>
                        <li><a href="/contact">Contact</a></li>
                    </ul>
      </div>
      
                <!-- Contact -->
                <div class="footer-column">
                    <h4>Contact Us</h4>
                    <ul class="footer-contact-modern">
                        <li>
                            <i class="fas fa-envelope"></i>
                            <span>support@medscan.ai</span>
                        </li>
                        <li>
                            <i class="fas fa-phone"></i>
                            <span>+91-9005529331</span>
                        </li>
                        <li>
                            <i class="fas fa-map-marker-alt"></i>
                            <span>India</span>
                        </li>
                    </ul>
          </div>
      </div>
      
            <!-- Bottom Bar -->
            <div class="footer-bottom-modern">
                <p>¬© 2025 Swasthmate. All rights reserved.</p>
                <div class="footer-legal-links-modern">
                    <a href="#">Privacy Policy</a>
                    <a href="#">Terms of Service</a>
                    <a href="#">Cookie Policy</a>
          </div>
          </div>
      </div>
    </footer>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/profile.js') }}"></script>
    <script>
        // Check if user is logged in
        function checkLoginStatus() {
            const userData = localStorage.getItem('userData');
            const loginContainer = document.getElementById('loginButtonContainer');
            const profileContainer = document.getElementById('profileButtonContainer');
            
            if (userData) {
                try {
                    const user = JSON.parse(userData);
                    if (user.loggedIn) {
                        if (loginContainer) loginContainer.style.display = 'none';
                        if (profileContainer) {
                            profileContainer.style.display = 'flex';
                            profileContainer.style.alignItems = 'center';
                        }
                        
                        // Update profile info
                        const avatar = document.getElementById('profileAvatarModern');
                        const nameEl = document.getElementById('dropdown-user-name-modern');
                        const emailEl = document.getElementById('dropdown-user-email-modern');
                        
                        if (avatar) avatar.textContent = user.name ? user.name.charAt(0).toUpperCase() : 'U';
                        if (nameEl) nameEl.textContent = user.name || 'User';
                        if (emailEl) emailEl.textContent = user.email || 'user@example.com';
                    } else {
                        if (loginContainer) loginContainer.style.display = 'block';
                        if (profileContainer) profileContainer.style.display = 'none';
                    }
                } catch (e) {
                    console.error('Error parsing user data:', e);
                    if (loginContainer) loginContainer.style.display = 'block';
                    if (profileContainer) profileContainer.style.display = 'none';
                }
            } else {
                if (loginContainer) loginContainer.style.display = 'block';
                if (profileContainer) profileContainer.style.display = 'none';
            }
        }

        // Profile Dropdown Toggle
        function toggleProfileDropdown() {
            const dropdown = document.getElementById('profileDropdownModern');
            if (dropdown) {
                dropdown.classList.toggle('active');
            }
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const profileContainer = document.getElementById('profileButtonContainer');
            const dropdown = document.getElementById('profileDropdownModern');
            if (profileContainer && dropdown && !profileContainer.contains(event.target)) {
                dropdown.classList.remove('active');
            }
        });

        // Logout Handler
        function handleLogout() {
            localStorage.removeItem('userData');
            localStorage.removeItem('isLoggedIn');
            globalThis.location.href = '/';
        }

        // Edit Profile
        function editProfile() {
            const userData = localStorage.getItem('userData');
            const profileView = document.getElementById('profile-view');
            const dropdown = document.getElementById('profileDropdownModern');
            
            // Close dropdown first
            if (dropdown) {
                dropdown.classList.remove('active');
            }
            
            if (userData) {
                const user = JSON.parse(userData);
                // Populate form fields
                const nameInput = document.getElementById('edit-name');
                const emailInput = document.getElementById('edit-email');
                const passwordInput = document.getElementById('edit-password');
                
                if (nameInput) nameInput.value = user.name || '';
                if (emailInput) emailInput.value = user.email || '';
                if (passwordInput) passwordInput.value = user.password || '';
            }
            
            // Show profile modal
            if (profileView) {
                profileView.style.display = 'flex';
                profileView.classList.add('active');
            }
        }
        
        // Close Profile Modal
        function closeProfile() {
            const profileView = document.getElementById('profile-view');
            if (profileView) {
                profileView.style.display = 'none';
                profileView.classList.remove('active');
            }
        }
        
        // Close profile modal when clicking outside
        document.addEventListener('click', function(event) {
            const profileView = document.getElementById('profile-view');
            // Removed unused variable
            if (profileView && event.target === profileView) {
                closeProfile();
            }
        });
        
        // Handle profile form submission
        const editProfileForm = document.getElementById('edit-profile-form');
        if (editProfileForm) {
            editProfileForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const name = document.getElementById('edit-name').value;
                const email = document.getElementById('edit-email').value;
                const password = document.getElementById('edit-password').value;
                
                if (!name || !email) {
                    alert('Please fill in name and email');
                    return;
                }
                
                const userData = localStorage.getItem('userData');
                const existingUser = userData ? JSON.parse(userData) : {};
                
                const updatedUser = {
                    name: name,
                    email: email,
                    password: password || existingUser.password || '',
                    loggedIn: true
                };
                
                localStorage.setItem('userData', JSON.stringify(updatedUser));
                checkLoginStatus();
                closeProfile();
                alert('Profile updated successfully!');
            });
        }

        // Mobile Menu Toggle
        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            if (menu) {
                menu.classList.toggle('active');
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
        });

        // FAQ Toggle
        function toggleFAQ(element) {
            const faqItem = element.parentElement;
            const isActive = faqItem.classList.contains('active');
            
            // Close all FAQ items
            for (const item of document.querySelectorAll('.faq-item-modern')) {
                item.classList.remove('active');
            }
            
            // Open clicked item if it wasn't active
            if (!isActive) {
                faqItem.classList.add('active');
            }
        }

        // File Upload Handler
        const fileInput = document.getElementById('file-upload');
        const dropzone = document.getElementById('dropzone-modern');
        const uploadContent = document.getElementById('uploadContent');
        const uploadProgress = document.getElementById('uploadProgress');
        const progressFill = document.getElementById('progressFill');
        const progressPercent = document.getElementById('progressPercent');

        if (fileInput) {
            fileInput.addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    handleFileUpload(e.target.files[0]);
                }
            });
        }

        // Drag and Drop
        if (dropzone) {
            for (const eventName of ['dragenter', 'dragover', 'dragleave', 'drop']) {
                dropzone.addEventListener(eventName, preventDefaults, false);
            }

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            for (const eventName of ['dragenter', 'dragover']) {
                dropzone.addEventListener(eventName, () => {
                    dropzone.classList.add('drag-over');
                }, false);
            }

            for (const eventName of ['dragleave', 'drop']) {
                dropzone.addEventListener(eventName, () => {
                    dropzone.classList.remove('drag-over');
                }, false);
            }

            dropzone.addEventListener('drop', handleDrop, false);

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                if (files.length > 0) {
                    fileInput.files = files;
                    handleFileUpload(files[0]);
                }
            }
        }

        // Progress Tracker Functions
        function updateProgressStep(step, statusText) {
            const steps = ['step1-modern', 'step2-modern', 'step3-modern', 'step4-modern'];
            const progressLineFill = document.getElementById('progressLineFillModern');
            const progressStatusText = document.getElementById('progressStatusTextModern');
            
            // Update progress line (0-100%)
            const progressPercent = (step / 4) * 100;
            if (progressLineFill) {
                progressLineFill.style.width = progressPercent + '%';
            }
            
            // Update status text
            if (progressStatusText) {
                progressStatusText.textContent = statusText;
            }
            
            // Update step states
            for (let i = 0; i < steps.length; i++) {
                const stepEl = document.getElementById(steps[i]);
                if (stepEl) {
                    stepEl.classList.remove('active', 'completed');
                    if (i < step) {
                        stepEl.classList.add('completed');
                    } else if (i === step - 1) {
                        stepEl.classList.add('active');
                    }
                }
            }
        }

        // Extract patient information from extracted text
        function extractPatientInfo(extractedText) {
            if (!extractedText) return {};
            
            const info = {
                name: '',
                age: '',
                gender: '',
                patientId: '',
                date: '',
                labName: ''
            };
            
            // Extract name (Mr/Mrs/Ms Name or Name: pattern)
            const nameMatch = extractedText.match(/(?:Mr\.?|Mrs\.?|Ms\.?)\s+([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)/i) ||
                             extractedText.match(/Name[:\-]?\s*([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)/i) ||
                             extractedText.match(/Prepared For\s+([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)/i);
            if (nameMatch) info.name = nameMatch[1] || nameMatch[0];
            
            // Extract age and gender (M 25, F 30, Age: 25, etc.)
            const ageGenderMatch = extractedText.match(/([MF])\s*(\d{1,2})/i) ||
                                  extractedText.match(/Age[:\-]?\s*(\d{1,2})/i);
            if (ageGenderMatch) {
                info.gender = ageGenderMatch[1] || '';
                info.age = ageGenderMatch[2] || ageGenderMatch[1] || '';
            }
            
            // Extract Patient ID
            const patientIdMatch = extractedText.match(/Patient ID[:\-]?\s*(\d+)/i);
            if (patientIdMatch) info.patientId = patientIdMatch[1];
            
            // Extract date
            const dateMatch = extractedText.match(/(\d{1,2}[-/]\d{1,2}[-/]\d{2,4})/);
            if (dateMatch) info.date = dateMatch[1];
            
            // Extract lab name
            const labMatch = extractedText.match(/([A-Z][a-z]+\s+(?:labs|Labs|LABS))/i);
            if (labMatch) info.labName = labMatch[1];
            
            return info;
        }

        function formatReportData(data, forDownload = false) {
            // More lenient validation - only check if data exists
            if (!data) {
                console.error('formatReportData: No data provided');
                return '<div class="professional-report"><p style="color: red; padding: 20px;">Error: No report data available</p></div>';
            }
            
            // Log data for debugging
            console.log('formatReportData called with:', {
                hasData: !!data,
                status: data.status,
                hasAnalysis: !!data.analysis,
                hasEnhanced: !!data.enhanced_analysis,
                hasMeasurements: !!data.measurements_analysis
            });
            
            const analysis = data.analysis || {};
            const enhanced = data.enhanced_analysis || {};
            const measurements = data.measurements_analysis || {};
            const priorityRecs = data.priority_recommendations || [];
            const extractedText = data.extracted_text || '';
            const patientInfo = extractPatientInfo(extractedText);
            
            const currentDate = new Date().toLocaleDateString('en-IN', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            const reportClass = forDownload ? 'professional-report' : 'result-summary-modern';
            
            let html = `
                <div class="${reportClass}" id="professionalReportContent">
                    ${forDownload ? `
                    <!-- Report Header with Logo -->
                    <div class="report-header">
                        <div class="report-header-top">
                            <div class="report-logo-section">
                                <div class="report-logo-box">
                                    <img src="/static/logo.png" alt="Swasthmate Logo" class="report-logo-img" onerror="this.style.display='none'">
                                    <div class="report-logo-text">Swasthmate</div>
                                </div>
                                <div class="report-company-info">
                                    <div class="report-company-name">Swasthmate Medical Report Analysis</div>
                                    <div class="report-company-tagline">AI-Powered Health Assessment System</div>
                                </div>
                            </div>
                            <div class="report-date-section">
                                <div class="report-date-label">Report Date</div>
                                <div class="report-date-value">${currentDate}</div>
                            </div>
                        </div>
                        <div class="report-title-section">
                            <h1 class="report-title">MEDICAL REPORT ANALYSIS</h1>
                            <div class="report-title-line"></div>
                        </div>
                    </div>
                    
                    <!-- Patient Information Section -->
                    <div class="report-section patient-info-section">
                        <h2 class="report-section-title">PATIENT INFORMATION</h2>
                        <div class="patient-info-grid">
                            <div class="patient-info-item">
                                <div class="patient-info-label">Patient Name:</div>
                                <div class="patient-info-value">${patientInfo.name || 'Not Available'}</div>
                            </div>
                            <div class="patient-info-item">
                                <div class="patient-info-label">Age:</div>
                                <div class="patient-info-value">${patientInfo.age || 'Not Available'}</div>
                            </div>
                            <div class="patient-info-item">
                                <div class="patient-info-label">Gender:</div>
                                <div class="patient-info-value">${patientInfo.gender || 'Not Available'}</div>
                            </div>
                            <div class="patient-info-item">
                                <div class="patient-info-label">Patient ID:</div>
                                <div class="patient-info-value">${patientInfo.patientId || data.report_id || 'N/A'}</div>
                            </div>
                            ${patientInfo.labName ? `
                            <div class="patient-info-item">
                                <div class="patient-info-label">Laboratory:</div>
                                <div class="patient-info-value">${patientInfo.labName}</div>
                            </div>
                            ` : ''}
                            <div class="patient-info-item">
                                <div class="patient-info-label">Report ID:</div>
                                <div class="patient-info-value">${data.report_id || 'N/A'}</div>
                            </div>
                            <div class="patient-info-item">
                                <div class="patient-info-label">Test Date:</div>
                                <div class="patient-info-value">${patientInfo.date || currentDate}</div>
                            </div>
                            <div class="patient-info-item">
                                <div class="patient-info-label">Generated On:</div>
                                <div class="patient-info-value">${currentDate}</div>
                            </div>
                        </div>
                    </div>
                    ` : `
                    <!-- Report Header -->
                    <div style="background: white; padding: 2rem; border-bottom: 2px solid #e5e7eb; margin-bottom: 2rem;">
                        <h1 style="font-size: 1.75rem; font-weight: 600; color: #1e293b; margin: 0 0 0.5rem 0;">Medical Report Analysis</h1>
                        <p style="color: #64748b; margin: 0; font-size: 0.9rem;">Report ID: ${data.report_id || 'N/A'} | File: ${data.filename || 'N/A'}</p>
                    </div>
                    
                    <!-- Patient Information Section -->
                    <div class="report-section patient-info-section" style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; border: 1px solid #e5e7eb; margin-bottom: 2rem;">
                        <h2 class="report-section-title" style="font-size: 1.25rem; font-weight: 600; color: #1e293b; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid #e5e7eb;">Patient Information</h2>
                        <div class="patient-info-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                            <div class="patient-info-item" style="padding: 0.75rem; background: white; border-radius: 6px; border-left: 3px solid #667eea;">
                                <div class="patient-info-label" style="font-size: 0.875rem; color: #64748b; font-weight: 500; margin-bottom: 0.25rem;">Patient Name:</div>
                                <div class="patient-info-value" style="font-size: 1rem; color: #1e293b; font-weight: 600;">${patientInfo.name || 'Not Available'}</div>
                            </div>
                            <div class="patient-info-item" style="padding: 0.75rem; background: white; border-radius: 6px; border-left: 3px solid #667eea;">
                                <div class="patient-info-label" style="font-size: 0.875rem; color: #64748b; font-weight: 500; margin-bottom: 0.25rem;">Age:</div>
                                <div class="patient-info-value" style="font-size: 1rem; color: #1e293b; font-weight: 600;">${patientInfo.age || 'Not Available'}</div>
                            </div>
                            <div class="patient-info-item" style="padding: 0.75rem; background: white; border-radius: 6px; border-left: 3px solid #667eea;">
                                <div class="patient-info-label" style="font-size: 0.875rem; color: #64748b; font-weight: 500; margin-bottom: 0.25rem;">Gender:</div>
                                <div class="patient-info-value" style="font-size: 1rem; color: #1e293b; font-weight: 600;">${patientInfo.gender || 'Not Available'}</div>
                            </div>
                            <div class="patient-info-item" style="padding: 0.75rem; background: white; border-radius: 6px; border-left: 3px solid #667eea;">
                                <div class="patient-info-label" style="font-size: 0.875rem; color: #64748b; font-weight: 500; margin-bottom: 0.25rem;">Patient ID:</div>
                                <div class="patient-info-value" style="font-size: 1rem; color: #1e293b; font-weight: 600;">${patientInfo.patientId || data.report_id || 'N/A'}</div>
                            </div>
                            ${patientInfo.labName ? `
                            <div class="patient-info-item" style="padding: 0.75rem; background: white; border-radius: 6px; border-left: 3px solid #667eea;">
                                <div class="patient-info-label" style="font-size: 0.875rem; color: #64748b; font-weight: 500; margin-bottom: 0.25rem;">Laboratory:</div>
                                <div class="patient-info-value" style="font-size: 1rem; color: #1e293b; font-weight: 600;">${patientInfo.labName}</div>
                            </div>
                            ` : ''}
                            <div class="patient-info-item" style="padding: 0.75rem; background: white; border-radius: 6px; border-left: 3px solid #667eea;">
                                <div class="patient-info-label" style="font-size: 0.875rem; color: #64748b; font-weight: 500; margin-bottom: 0.25rem;">Test Date:</div>
                                <div class="patient-info-value" style="font-size: 1rem; color: #1e293b; font-weight: 600;">${patientInfo.date || currentDate}</div>
                            </div>
                            <div class="patient-info-item" style="padding: 0.75rem; background: white; border-radius: 6px; border-left: 3px solid #667eea;">
                                <div class="patient-info-label" style="font-size: 0.875rem; color: #64748b; font-weight: 500; margin-bottom: 0.25rem;">Generated On:</div>
                                <div class="patient-info-value" style="font-size: 1rem; color: #1e293b; font-weight: 600;">${currentDate}</div>
                            </div>
                        </div>
                    </div>
                    `}
                    
                    ${analysis.diseases && analysis.diseases.length > 0 ? `
                    <div class="report-section" style="margin: 2rem 0;">
                        <h2 class="report-section-title" style="font-size: 1.25rem; font-weight: 600; color: #1e293b; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid #e5e7eb;">Detected Medical Conditions</h2>
                        ${forDownload ? `
                        <ul class="report-list" style="list-style: none; padding: 0;">
                            ${analysis.diseases.map(d => `<li style="padding: 0.75rem; margin: 0.5rem 0; background: #f8fafc; border-left: 3px solid #667eea; border-radius: 4px;">${d}</li>`).join('')}
                        </ul>
                        ` : `
                        <ul style="list-style: none; padding: 0; margin: 0;">
                            ${analysis.diseases.map(d => `<li style="padding: 0.75rem; margin: 0.5rem 0; background: #f8fafc; border-left: 3px solid #667eea; border-radius: 4px; color: #1e293b;">${d}</li>`).join('')}
                        </ul>
                        `}
                    </div>
                    ` : ''}
                    
                    ${measurements.analyzed_measurements ? `
                    <div class="report-section" style="margin: 2rem 0;">
                        <h2 class="report-section-title" style="font-size: 1.25rem; font-weight: 600; color: #1e293b; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid #e5e7eb;">Laboratory Test Results</h2>
                        ${forDownload ? `
                        <table class="report-table" style="width: 100%; border-collapse: collapse; margin-top: 1rem;">
                            <thead>
                                <tr style="background: #f8fafc;">
                                    <th style="padding: 0.75rem; text-align: left; font-weight: 600; color: #1e293b; border-bottom: 2px solid #e5e7eb;">Test Name</th>
                                    <th style="padding: 0.75rem; text-align: left; font-weight: 600; color: #1e293b; border-bottom: 2px solid #e5e7eb;">Value</th>
                                    <th style="padding: 0.75rem; text-align: left; font-weight: 600; color: #1e293b; border-bottom: 2px solid #e5e7eb;">Unit</th>
                                    <th style="padding: 0.75rem; text-align: left; font-weight: 600; color: #1e293b; border-bottom: 2px solid #e5e7eb;">Status</th>
                                    <th style="padding: 0.75rem; text-align: left; font-weight: 600; color: #1e293b; border-bottom: 2px solid #e5e7eb;">Normal Range</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${Object.entries(measurements.analyzed_measurements).map(([test, values]) => {
                                    if (!Array.isArray(values) || values.length === 0) return '';
                                    return values.map(v => {
                                        const statusClass = v.status?.toLowerCase() || 'normal';
                                        const badgeClass = `report-badge report-badge-${statusClass}`;
                                        return `
                                            <tr>
                                                <td style="padding: 0.75rem; border-bottom: 1px solid #e5e7eb;"><strong>${test}</strong></td>
                                                <td style="padding: 0.75rem; border-bottom: 1px solid #e5e7eb;"><strong>${v.value || '-'}</strong></td>
                                                <td style="padding: 0.75rem; border-bottom: 1px solid #e5e7eb;">${v.unit || '-'}</td>
                                                <td style="padding: 0.75rem; border-bottom: 1px solid #e5e7eb;"><span class="${badgeClass}">${v.status_icon || ''} ${v.status || 'Normal'}</span></td>
                                                <td style="padding: 0.75rem; border-bottom: 1px solid #e5e7eb;">${v.normal_range || '-'}</td>
                                            </tr>
                                        `;
                                    }).join('');
                                }).filter(row => row).join('')}
                            </tbody>
                        </table>
                        ` : `
                        <div style="overflow-x: auto; margin-top: 1rem;">
                            <table class="report-table" style="width: 100%; border-collapse: collapse; background: white;">
                                <thead>
                                    <tr style="background: #f8fafc;">
                                        <th style="padding: 0.75rem; text-align: left; font-weight: 600; color: #1e293b; border-bottom: 2px solid #e5e7eb;">Test Name</th>
                                        <th style="padding: 0.75rem; text-align: left; font-weight: 600; color: #1e293b; border-bottom: 2px solid #e5e7eb;">Value</th>
                                        <th style="padding: 0.75rem; text-align: left; font-weight: 600; color: #1e293b; border-bottom: 2px solid #e5e7eb;">Unit</th>
                                        <th style="padding: 0.75rem; text-align: left; font-weight: 600; color: #1e293b; border-bottom: 2px solid #e5e7eb;">Status</th>
                                        <th style="padding: 0.75rem; text-align: left; font-weight: 600; color: #1e293b; border-bottom: 2px solid #e5e7eb;">Normal Range</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${Object.entries(measurements.analyzed_measurements).map(([test, values]) => {
                                        if (!Array.isArray(values) || values.length === 0) return '';
                                        return values.map((v, idx) => {
                                            const statusClass = v.status?.toLowerCase() || 'normal';
                                            const statusColor = v.status_color || '#10b981';
                                            const rowBg = idx % 2 === 0 ? '#ffffff' : '#f8fafc';
                                            return `
                                                <tr style="background: ${rowBg}; border-bottom: 1px solid #e5e7eb;">
                                                    <td style="padding: 0.75rem; color: #1e293b; font-weight: 500;">${test}</td>
                                                    <td style="padding: 0.75rem; color: #1e293b; font-weight: 600;">${v.value || '-'}</td>
                                                    <td style="padding: 0.75rem; color: #64748b;">${v.unit || '-'}</td>
                                                    <td style="padding: 0.75rem;">
                                                        <span style="padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.875rem; font-weight: 500; color: ${statusColor}; background: ${v.status_bg || '#d1fae5'};">${v.status_icon || ''} ${v.status || 'Normal'}</span>
                                                    </td>
                                                    <td style="padding: 0.75rem; color: #64748b; font-size: 0.9rem;">${v.normal_range || '-'}</td>
                                                </tr>
                                            `;
                                        }).join('');
                                    }).filter(row => row).join('')}
                                </tbody>
                            </table>
                        </div>
                        `}
                        ${measurements.abnormal_count > 0 ? `
                        <div style="margin-top: 1.5rem; padding: 1rem; background: #fef3c7; border-radius: 6px; border-left: 4px solid #d97706;">
                            <p style="margin: 0; color: #92400e; font-weight: 500;">
                                ‚ö†Ô∏è ${measurements.abnormal_count} out of ${measurements.total_tests} tests show abnormal values
                            </p>
                        </div>
                        ` : ''}
                    </div>
                    ` : ''}
                    
                    ${data.recommendations && data.recommendations.length > 0 ? `
                    <div class="report-section" style="margin: 2rem 0;">
                        <h2 class="report-section-title" style="font-size: 1.25rem; font-weight: 600; color: #1e293b; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid #e5e7eb;">General Recommendations</h2>
                        ${forDownload ? `
                        <ul class="report-list" style="list-style: none; padding: 0;">
                            ${data.recommendations.map(r => `<li style="padding: 0.75rem; margin: 0.5rem 0; background: #f8fafc; border-left: 3px solid #10b981; border-radius: 4px;">${r}</li>`).join('')}
                        </ul>
                        ` : `
                        <ul style="list-style: none; padding: 0; margin: 0;">
                            ${data.recommendations.map(r => `<li style="padding: 0.75rem; margin: 0.5rem 0; background: #f8fafc; border-left: 3px solid #10b981; border-radius: 4px; color: #1e293b;">${r}</li>`).join('')}
                        </ul>
                        `}
                    </div>
                    ` : ''}
                    
                    ${data.drug_interactions && data.drug_interactions.length > 0 ? `
                    <div class="report-section" style="margin: 2rem 0;">
                        <h2 class="report-section-title" style="font-size: 1.25rem; font-weight: 600; color: #1e293b; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid #e5e7eb;">Drug Interactions</h2>
                        ${forDownload ? `
                        <ul class="report-list" style="list-style: none; padding: 0;">
                            ${data.drug_interactions.map(interaction => `
                                <li style="padding: 0.75rem; margin: 0.5rem 0; background: #fef2f2; border-left: 3px solid #dc2626; border-radius: 4px;">
                                    <strong>${interaction.medication1 || interaction.drug1 || 'Unknown'}</strong> + 
                                    <strong>${interaction.medication2 || interaction.drug2 || 'Unknown'}</strong>
                                    ${interaction.description ? `<br><span style="color: #64748b; font-size: 0.9rem;">${interaction.description}</span>` : ''}
                                </li>
                            `).join('')}
                        </ul>
                        ` : `
                        <ul style="list-style: none; padding: 0; margin: 0;">
                            ${data.drug_interactions.map(interaction => `
                                <li style="padding: 0.75rem; margin: 0.5rem 0; background: #fef2f2; border-left: 3px solid #dc2626; border-radius: 4px; color: #1e293b;">
                                    <strong>${interaction.medication1 || interaction.drug1 || 'Unknown'}</strong> + 
                                    <strong>${interaction.medication2 || interaction.drug2 || 'Unknown'}</strong>
                                    ${interaction.description ? `<div style="color: #64748b; font-size: 0.9rem; margin-top: 0.5rem;">${interaction.description}</div>` : ''}
                                </li>
                            `).join('')}
                        </ul>
                        `}
                    </div>
                    ` : ''}
                    
                    ${!forDownload && !analysis.diseases && !measurements.analyzed_measurements && !data.recommendations && !data.drug_interactions ? `
                    <div class="report-section" style="margin: 2rem 0; padding: 2rem; background: #f8fafc; border-radius: 8px; border: 1px solid #e5e7eb;">
                        <h2 class="report-section-title" style="font-size: 1.25rem; font-weight: 600; color: #1e293b; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid #e5e7eb;">Report Summary</h2>
                        <p style="color: #64748b; line-height: 1.6; margin: 0;">
                            ${enhanced.summary_text || 'Analysis is being processed. Please wait or refresh the page.'}
                        </p>
                        ${extractedText ? `
                        <div style="margin-top: 1rem; padding: 1rem; background: white; border-radius: 6px; border: 1px solid #e5e7eb;">
                            <h3 style="font-size: 0.9rem; color: #374151; margin-bottom: 0.5rem; font-weight: 600;">Extracted Text Preview:</h3>
                            <p style="font-size: 0.85rem; color: #6b7280; line-height: 1.5; max-height: 200px; overflow-y: auto; margin: 0;">
                                ${extractedText.substring(0, 500)}${extractedText.length > 500 ? '...' : ''}
                            </p>
                        </div>
                        ` : ''}
                    </div>
                    ` : ''}
                    
                    ${forDownload ? `
                    <!-- Report Footer -->
                    <div class="report-footer">
                        <div class="report-footer-line"></div>
                        <div class="report-footer-content">
                            <div class="report-footer-left">
                                <div class="report-footer-logo-text">Swasthmate</div>
                                <div class="report-footer-address">
                                    <p>AI-Powered Medical Report Analysis System</p>
                                    <p>support@swasthmate.com | +91-9005529331</p>
                                </div>
                            </div>
                            <div class="report-footer-right">
                                <div class="report-footer-disclaimer">
                                    <p><strong>IMPORTANT DISCLAIMER:</strong></p>
                                    <p>This report is generated by AI and is for informational purposes only. It should not replace professional medical advice, diagnosis, or treatment. Always consult with a qualified healthcare professional for medical decisions.</p>
                                    <p style="margin-top: 0.5rem; font-size: 0.75rem;">Report ID: ${data.report_id || 'N/A'} | Generated: ${currentDate}</p>
                                </div>
                            </div>
                        </div>
                        <div class="report-footer-bottom">
                            <p>&copy; ${new Date().getFullYear()} Swasthmate. All rights reserved.</p>
                        </div>
                    </div>
                    ` : ''}
                    
                    <!-- Ensure at least some content is always present -->
                    ${forDownload && !analysis.diseases && !measurements.analyzed_measurements && !priorityRecs.length && !data.recommendations && !data.drug_interactions ? `
                    <div class="report-section">
                        <h2 class="report-section-title">Report Summary</h2>
                        <p style="color: #666; line-height: 1.6;">
                            ${enhanced.summary_text || 'No detailed analysis available for this report. Please ensure the uploaded document contains readable medical information.'}
                        </p>
                        ${extractedText ? `
                        <div style="margin-top: 1rem; padding: 1rem; background: #f9fafb; border-radius: 8px;">
                            <h3 style="font-size: 0.9rem; color: #374151; margin-bottom: 0.5rem;">Extracted Text:</h3>
                            <p style="font-size: 0.85rem; color: #6b7280; line-height: 1.5; max-height: 200px; overflow-y: auto;">
                                ${extractedText.substring(0, 500)}${extractedText.length > 500 ? '...' : ''}
                            </p>
                        </div>
                        ` : ''}
                    </div>
                    ` : ''}
                </div>
            `;
            
            // Validate that HTML was generated
            if (!html || html.trim().length === 0) {
                console.error('formatReportData: Generated empty HTML');
                return '<div class="professional-report"><p style="color: red; padding: 20px;">Error: Failed to generate report content</p></div>';
            }
            
            return html;
        }

        function displayFormattedResult(data) {
            const resultSection = document.getElementById('resultDisplaySection');
            const resultContent = document.getElementById('resultContent');
            const resultFileName = document.getElementById('resultFileName');
            const progressTracker = document.getElementById('progressTrackerContainer');
            
            if (resultSection && resultContent) {
                // Hide progress tracker
                if (progressTracker) progressTracker.style.display = 'none';
                
                // Show result section
                resultSection.style.display = 'block';
                
                // Set filename
                if (resultFileName) {
                    resultFileName.textContent = `File: ${data.filename || 'Unknown'}`;
                }
                
                // Display formatted content (not for download)
                resultContent.innerHTML = formatReportData(data, false);
                
                // Store data for View buttons
                window.currentReportData = data;
            }
        }

        function handleFileUpload(file) {
            // Hide upload content, show progress tracker
            const uploadContent = document.getElementById('uploadContent');
            const progressTracker = document.getElementById('progressTrackerContainer');
            const resultSection = document.getElementById('resultDisplaySection');
            
            if (uploadContent) uploadContent.style.display = 'none';
            if (progressTracker) progressTracker.style.display = 'block';
            if (resultSection) resultSection.style.display = 'none';
            
            // Step 1: Uploading
            updateProgressStep(1, 'Uploading your report...');
            
            const formData = new FormData();
            formData.append('report', file);
            
            const xhr = new XMLHttpRequest();
            
            // Track upload progress
            xhr.upload.addEventListener('progress', (e) => {
                if (e.lengthComputable) {
                    const uploadPercent = (e.loaded / e.total) * 25; // 25% for upload
                    const progressLineFill = document.getElementById('progressLineFillModern');
                    if (progressLineFill) {
                        progressLineFill.style.width = uploadPercent + '%';
                    }
                }
            });
            
            xhr.onload = () => {
                if (xhr.status === 200) {
                    try {
                        const data = JSON.parse(xhr.responseText);
                        
                        if (data.status === 'success') {
                            // Step 2: Analysis (25-50%)
                            updateProgressStep(2, 'Analyzing with OCR and NLP...');
                            
                            setTimeout(() => {
                                // Step 3: Processing (50-75%)
                                updateProgressStep(3, 'Processing medical data...');
                                
                                setTimeout(() => {
                                    // Step 4: Result (75-100%)
                                    updateProgressStep(4, 'Report generated successfully!');
                                    
                                    setTimeout(() => {
                                        // Display formatted results
                                        displayFormattedResult(data);
                                        
                                        // Store in sessionStorage
                                        if (typeof sessionStorage !== 'undefined') {
                                            sessionStorage.setItem('reportData', JSON.stringify(data));
                                            sessionStorage.setItem('report_id', data.report_id || '');
                                        }
                                    }, 500);
                                }, 1000);
                            }, 1000);
                        } else {
                            alert('Upload failed: ' + (data.message || 'Unknown error'));
                            resetUploadUI();
                        }
                    } catch (e) {
                        console.error('Parse error:', e);
                        alert('Failed to parse response. Please try again.');
                        resetUploadUI();
                    }
                } else {
                    alert(`Upload failed: ${xhr.statusText}`);
                    resetUploadUI();
                }
            };
            
            xhr.onerror = () => {
                alert('Network error occurred. Please try again.');
                resetUploadUI();
            };
            
            xhr.open('POST', '/upload');
            xhr.send(formData);
        }
        
        function resetUploadUI() {
            const uploadContent = document.getElementById('uploadContent');
            const progressTracker = document.getElementById('progressTrackerContainer');
            const resultSection = document.getElementById('resultDisplaySection');
            
            if (uploadContent) uploadContent.style.display = 'block';
            if (progressTracker) progressTracker.style.display = 'none';
            if (resultSection) resultSection.style.display = 'none';
        }
        
        // Download Report as PDF
        function downloadReportAsPDF(data) {
            // Validate data first
            if (!data) {
                console.error('downloadReportAsPDF: No data provided');
                alert('Error: No report data available. Please generate a report first.');
                return;
            }
            
            console.log('downloadReportAsPDF called with data:', {
                report_id: data.report_id,
                filename: data.filename,
                hasAnalysis: !!data.analysis,
                hasEnhanced: !!data.enhanced_analysis
            });
            
            // Show loading message
            const downloadBtn = document.getElementById('downloadReportBtn');
            const originalText = downloadBtn ? downloadBtn.innerHTML : '';
            if (downloadBtn) {
                downloadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating PDF...';
                downloadBtn.disabled = true;
            }
            
            // Create a temporary container for the professional report
            const tempContainer = document.createElement('div');
            tempContainer.style.position = 'absolute';
            tempContainer.style.left = '-9999px';
            tempContainer.style.top = '-9999px';
            tempContainer.style.width = '900px';
            tempContainer.style.background = 'white';
            tempContainer.style.padding = '20px';
            
            // Generate report HTML
            const reportHTML = formatReportData(data, true);
            if (!reportHTML || reportHTML.trim().length === 0) {
                console.error('formatReportData returned empty HTML');
                alert('Error: Failed to generate report content. Please try again.');
                if (downloadBtn) {
                    downloadBtn.innerHTML = originalText;
                    downloadBtn.disabled = false;
                }
                return;
            }
            
            tempContainer.innerHTML = reportHTML;
            document.body.appendChild(tempContainer);
            
            // Wait a bit for images to load and DOM to render
            setTimeout(() => {
                // Use html2pdf library if available
                if (typeof html2pdf !== 'undefined' && html2pdf) {
                    const element = tempContainer.querySelector('.professional-report');
                    if (element) {
                        // Verify element has content
                        if (element.innerHTML.trim().length === 0) {
                            console.error('Report element is empty');
                            alert('Error: Report content is empty. Please check the console for details.');
                            if (document.body.contains(tempContainer)) {
                                document.body.removeChild(tempContainer);
                            }
                            if (downloadBtn) {
                                downloadBtn.innerHTML = originalText;
                                downloadBtn.disabled = false;
                            }
                            return;
                        }
                        const opt = {
                            margin: [15, 15, 15, 15],
                            filename: `Medical_Report_${data.report_id || 'Report'}_${new Date().getTime()}.pdf`,
                            image: { type: 'jpeg', quality: 0.98 },
                            html2canvas: { 
                                scale: 2, 
                                useCORS: true,
                                logging: false,
                                letterRendering: true
                            },
                            jsPDF: { 
                                unit: 'mm', 
                                format: 'a4', 
                                orientation: 'portrait',
                                compress: true
                            },
                            pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
                        };
                        
                        html2pdf().set(opt).from(element).save().then(() => {
                            if (document.body.contains(tempContainer)) {
                                document.body.removeChild(tempContainer);
                            }
                            if (downloadBtn) {
                                downloadBtn.innerHTML = originalText;
                                downloadBtn.disabled = false;
                            }
                        }).catch((err) => {
                            console.error('PDF generation error:', err);
                            alert('PDF generation failed. Using print option instead.');
                            fallbackPrintReport(data, tempContainer);
                            if (downloadBtn) {
                                downloadBtn.innerHTML = originalText;
                                downloadBtn.disabled = false;
                            }
                        });
                    } else {
                        console.error('Report element not found in tempContainer');
                        console.log('tempContainer HTML:', tempContainer.innerHTML.substring(0, 500));
                        alert('Error: Could not find report content. Trying fallback method...');
                        fallbackPrintReport(data, tempContainer);
                        if (downloadBtn) {
                            downloadBtn.innerHTML = originalText;
                            downloadBtn.disabled = false;
                        }
                    }
                } else {
                    // Fallback: Use print functionality
                    fallbackPrintReport(data, tempContainer);
                    if (downloadBtn) {
                        downloadBtn.innerHTML = originalText;
                        downloadBtn.disabled = false;
                    }
                }
            }, 500);
        }
        
        function fallbackPrintReport(data, tempContainer) {
            const printWindow = window.open('', '_blank', 'width=900,height=1200');
            const reportHTML = formatReportData(data, true);
            const styleEl = document.querySelector('style');
            const styleContent = styleEl ? styleEl.innerHTML : '';
            const filename = data.filename || 'Report';
            
            printWindow.document.open();
            printWindow.document.write('<!DOCTYPE html><html lang="en"><head><title>Medical Report - ' + filename + '</title>');
            printWindow.document.write('<meta charset="UTF-8">');
            printWindow.document.write('<style>' + styleContent);
            printWindow.document.write('body { margin: 0; padding: 20px; background: white; }');
            printWindow.document.write('@media print { @page { margin: 1.5cm; size: A4; } }');
            printWindow.document.write('</style></head><body>');
            printWindow.document.write(reportHTML);
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            
            // Trigger print after window loads
            setTimeout(() => {
                printWindow.print();
                setTimeout(() => {
                    if (document.body.contains(tempContainer)) {
                        document.body.removeChild(tempContainer);
                    }
                }, 1000);
            }, 500);
        }
        
        // View Report Button Handler
        document.addEventListener('DOMContentLoaded', function() {
            const viewReportBtn = document.getElementById('viewReportBtn');
            const uploadNewBtn = document.getElementById('uploadNewBtn');
            
            if (viewReportBtn) {
                viewReportBtn.addEventListener('click', function() {
                    if (window.currentReportData) {
                        // Store data and navigate to analysis page
                        sessionStorage.setItem('reportData', JSON.stringify(window.currentReportData));
                        window.location.href = '/analysis';
                    }
                });
            }
            
            const downloadReportBtn = document.getElementById('downloadReportBtn');
            if (downloadReportBtn) {
                downloadReportBtn.addEventListener('click', function() {
                    // Try to get data from window.currentReportData first
                    let reportData = window.currentReportData;
                    
                    // Fallback: Try to get from sessionStorage
                    if (!reportData && typeof sessionStorage !== 'undefined') {
                        const storedData = sessionStorage.getItem('reportData');
                        if (storedData) {
                            try {
                                reportData = JSON.parse(storedData);
                                window.currentReportData = reportData; // Cache it
                            } catch (e) {
                                console.error('Failed to parse stored report data:', e);
                            }
                        }
                    }
                    
                    if (reportData) {
                        downloadReportAsPDF(reportData);
                    } else {
                        alert('Error: No report data available. Please upload and analyze a report first.');
                    }
                });
            }
            
            if (uploadNewBtn) {
                uploadNewBtn.addEventListener('click', function() {
                    resetUploadUI();
                    const fileInput = document.getElementById('file-upload');
                    if (fileInput) fileInput.value = '';
                    window.currentReportData = null;
                });
            }
        });

        // Smooth scroll for anchor links (only for # links, not full URLs)
        for (const anchor of document.querySelectorAll('a[href^="#"]')) {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        }
        
        // Ensure About and Contact links work properly
        for (const link of document.querySelectorAll('a[href="/about"], a[href="/contact"]')) {
            link.addEventListener('click', function(e) {
                // Allow normal navigation
                return true;
            });
        }

        // Intersection Observer for animations
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            for (const entry of entries) {
                if (entry.isIntersecting) {
                    entry.target.classList.add('animate-in');
                }
            }
        }, observerOptions);

        // Observe elements for animation
        for (const el of document.querySelectorAll('.feature-card-modern, .step-card-modern, .stat-item-modern, .faq-item-modern')) {
            observer.observe(el);
        }
    </script>
    </body>
    </html>
    
